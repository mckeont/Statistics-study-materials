---
title: "Factors"
author: "Donna L. Coffman"
date: "1/23/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Factors

A `factor` is a special `character` vector where the elements have pre-defined groups or 'levels'. You can think of these as qualitative or categorical variables. Factors are used to represent categorical data. Factors can be ordered or unordered, and understanding them is necessary for statistical analysis and for plotting. Factors are very useful and make R particularly well suited to working with data. Once created, factors can only contain a pre-defined set of values, known as *levels*. By default, R always sorts *levels* in alphabetical order.

Factors are stored as integers, and have labels (text) associated with these
unique integers. While factors look (and often behave) like character vectors,
they are actually integers under the hood, and you need to be careful when
treating them like strings. Note that R reads in character strings as factors by default in functions like `read.table()`. Factors can be converted to `numeric` or `character` very easily.

For instance, if you have a factor with 2 levels:

```{r, purl=TRUE}
sex <- factor(c("male", "female", "female", "male"))
str(sex)
sex
```

R will assign `1` to the level `"female"` and `2` to the level `"male"` (because `f` comes before `m` in the alphabet, even though the first element in this vector is `"male"`). You can check this by using the function `levels()`, and check the number of levels using `nlevels()`:

```{r, purl=FALSE}
levels(sex)
nlevels(sex)
```

Sometimes, the order of the factors does not matter, other times you might want
to specify the order because it is meaningful (e.g., "low", "medium", "high"),
it improves your visualization, or it is required by a particular type of
analysis. Here, one way to reorder our levels in the `sex` vector would be:

```{r, results=TRUE, purl=FALSE}
sex # current order
sex <- factor(sex, levels = c("male", "female"))
sex # after re-ordering
```

In R's memory, these factors are represented by integers (1, 2), but are more
informative than integers because factors are self describing: `"female"`,
`"male"` is more descriptive than `1`, `2`. Which one is "male"?  You wouldn't
be able to tell just from the integer data. Factors, on the other hand, have
this information built in. It is particularly helpful when there are many levels.

### Converting factors

If you need to convert a factor to a character vector, you use
`as.character()`.

```{r, purl=FALSE}
as.character(sex)
```

Converting factors where the levels appear as numbers (such as concentration
levels, or years) to a numeric vector is a little trickier. The `as.numeric()` 
function returns the index values of the factor, not its levels, so it will 
result in an entirely new (and unwanted in this case) set of numbers. 
One method to avoid this is to convert factors to characters and then numbers.  
Another method is to use the `levels()` function. Compare:

```{r, purl=TRUE}
f <- factor(c(1990, 1983, 1977, 1998, 1990))
as.numeric(f)               # Wrong! And there is no warning...
as.numeric(as.character(f)) # Works...
as.numeric(levels(f))[f]    # The recommended way.
```

Notice that in the `levels()` approach, three important steps occur:

* We obtain all the factor levels using `levels(f)`
* We convert these levels to numeric values using `as.numeric(levels(f))`
* We then access these numeric values using the underlying integers of the
  vector `f` inside the square brackets
  
You can convert numeric vectors to factors by using `as.factor()` or `factor()`

```{r}
sex <- c(1, 0, 0, 1)
as.factor(sex)
factor(sex) #does the same thing as as.factor()
```

### Using `stringsAsFactors=FALSE`

By default, when building or importing a data frame, the columns that contain
characters (i.e., text) are coerced (i.e., converted) into the `factor` data
type. Depending on what you want to do with the data, you may want to keep these columns as `character`. To do so, `read.csv()` and `read.table()` have an
argument called `stringsAsFactors` which can be set to `FALSE`.

In most cases, it is preferable to set `stringsAsFactors = FALSE` when importing your data, and converting to a factor only the columns that require this data type.

The automatic conversion of data type is sometimes a blessing, sometimes an
annoyance. Be aware that it exists, learn the rules, and double check that data
you import into R are of the correct type within your data frame. If not, use it to your advantage to detect mistakes that might have been introduced during data entry (a letter in a column that should only contain numbers for instance).
